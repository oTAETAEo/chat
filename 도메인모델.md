# Chat 도메인 모델

---
### PK 생성 방법
- snowflake 사용

---

### 회원(Member)
_Aggregate Root_
#### 속성
- `id` : `Long`
- `publicId` : 공개 아이디
- `email` : 이메일 - Natural ID
- `name` : 이름
- `nickname` : 별명
- `passwordHash` : 비밀번호 해시
- `birthDate` : 생년월일
- `status` : 회원 상태 (`ACTIVE`, `WITHDRAWN`)

#### 행위
- `static register()` : 회원 등록
  - `email`, `name`, `nickname`, `password`, `birthDate`, `passwordEncoder`
- `verifyPassword()` : 비밀번호 검증
- `changeName()` : 이름 변경
- `changeNickname()` : 별명 변경
- `changePassword()` : 비밀번호 변경
- `changeBirthDate()` : 생년월일 변경
- `withdraw()` : 회원 탈퇴

#### 규칙
- 이름, 이메일은 고유하다
- 이름에는 영어, 언더바(_)만 사용할수 있다
- 별명이 없는 경우 이름과 같게 한다

---

### 친구 관계(Friendship)
_Aggregate Root_
#### 속성
- `id` : `Long`
- `publicId` : 공개 아이디
- `fromMember` : 친구 요청 보낸 사람
- `toMember` : 친구 요청 받은 사람
- `status` : 친구 관계 상태

#### 행위
- `static register()` : 친구 추가 요청
    - `fromMember`, `toMember`
- `accept()` : 친구 수락 (`ACCEPTED`로 변경)
- `reject()` : 친구 거절 (`REJECTED`로 변경)
- `block()` : 차단 (`BLOCKED`로 변경)

#### 규칙
- `status`가 `PENDING`인 경우에만 `ACCEPTED` 혹은 `REJECTED`로 변경 가능
- `status`가 `ACCEPTED`인 경우에만 `BLOCKED`로 변경 가능
- `PENDING` 상태인 친구 관계가 있으면 친구 요청을 다시 보낼수 없다
- `BLOCKED` 상태인 친구 관계가 있으면 친구 요청을 보낼수 없다

### 친구 관계 상태(FriendshipStatus)
_Enum_
#### 상수
- `PENDING` : 대기
- `ACCEPTED` : 승인
- `REJECTED` : 거절
- `BLOCKED` : 차단

--- 

### 채팅 방 참여 회원(ChatRoomMember)
_Aggregate Root_
#### 속성
- `member` : (`Member` 1 : n `ChatRoomMember` )
- `chatRoom` : (`ChatRoom` 1 : n `ChatRoomMember` )
- `role` : 채팅방 내 권한 (`OWNER`, `MEMBER`)
- `lastReadMessageId` : 마지막으로 읽은 메시지 ID (읽음 처리용)

#### 행위
- `static register()` : 채팅 방 참여 (초대)
  - `member`, `chatRoom`, `role`
- `exit()` : 채팅방 나가기
- `readMessage()` : 메시지 읽음 처리 (`lastReadMessageId` 갱신)

#### 규칙
- 채팅방이 생성 된 후 생성될수 있다
- `PRIVATE` 채팅방은 나갔다가 다시 들어오면 기존 `ChatRoomMember`를 재활성화 하거나 새로 생성한다.

---

### 채팅 방(ChatRoom)
_Aggregate Root_
#### 속성
- `id` : `Long`
- `publicId` : 공개 아이디
- `title` : 채팅방 제목 (Group 채팅용, Private은 상대방 이름 표시)
- `roomType` : 채팅방 타입

#### 행위
- `static register()` : 채팅 방 생성
  - `roomType`, `title` (Optional)
- `changeTitle()` : 방 제목 변경 (Group 채팅만 가능)

#### 규칙
- `PRIVATE` 채팅방은 참여 인원이 2명으로 제한된다.

### 채팅방 타입(RoomType)
_Enum_
#### 상수
- `PRIVATE` : 1대1 채팅방
- `GROUP` : 그룹 채팅방

---

### 채팅 메시지(ChatMessage)
_Aggregate Root_
#### 속성
- `id` : `Long`
- `content` : 내용 
- `sender` : 보낸 사람 (`Member` 1 : n `Message`)
- `chatRoom` : 소속 채팅방 (`ChatRoom` 1 : n `ChatMessage`)
- `softDeleteInfo` : 삭제 정보 (Value Object)
  - `isDeleted` : 삭제 여부
  - `deletedAt` : 삭제 일시
  - `deletedByMemberId` : 삭제 요청자

#### 행위
- `static register()` : 메시지 생성
- `modify()` : 메시지 수정
- `delete()` : 메시지 삭제 (Soft Delete)

#### 규칙
- 삭제된 메시지는 30일간 보관 후 물리 삭제된다 (별도 배치 처리).
- 삭제된 메시지는 조회 시 노출되지 않아야 한다.
- 본인이 작성한 메시지만 수정/삭제 가능하다.
